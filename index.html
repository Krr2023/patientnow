<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>網頁顯示時間和數字</title>
</head>
<body>
  <h1>優植牙醫診所</h1>
  <h2>王志綱醫師</h2>
  <h3>現在看診號碼</h3>
  <p id="time"></p>

  <form id="number-form">
    <input type="number" id="user-input" name="number">
    <button type="submit">提交</button>
  </form>

  <p id="number"></p>
  <button id="add">加一</button>
  <button id="subtract">減一</button>

  <script>
    const timeElement = document.getElementById("time");
    const numberElement = document.getElementById("number");
    const addButton = document.getElementById("add");
    const subtractButton = document.getElementById("subtract");
    const numberForm = document.getElementById("number-form");

    let number = 0;

    // 顯示現在時間
    function updateTime() {
      const now = new Date();
      timeElement.textContent = now.toLocaleString();
    }

    // 更新數字
    function updateNumber() {
      numberElement.textContent = number;
    }

    // 加一
    addButton.addEventListener("click", () => {
      number++;
      updateNumber();
    });

    // 減一
    subtractButton.addEventListener("click", () => {
      number--;
      updateNumber();
    });

    // 提交表單時更新數字
    numberForm.addEventListener("submit", (event) => {
      event.preventDefault(); // 防止表單提交刷新頁面

      const userNumber = parseInt(document.getElementById("user-input").value, 10);
      if (isNaN(userNumber)) {
        return;
      }

      number = userNumber;
      updateNumber();

      // 將使用者輸入的數值儲存至 localStorage
      localStorage.setItem("userNumber", userNumber);

      // 將使用者輸入的數值送出至 Netlify API
      fetch("/api/store-number", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          number: userNumber,
        }),
      });
    });

    // 初始化
    updateTime();
    updateNumber();

    // 每秒更新時間
    setInterval(updateTime, 1000);
  </script>
</body>
</html>
