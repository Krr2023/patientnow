<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>網頁顯示時間和數字</title>
</head>
<body>
  <p id="time"></p>
  <input type="number" id="number-input">
  <p id="number"></p>
  <button id="add">加一</button>
  <button id="subtract">減一</button>

  <script>
    const timeElement = document.getElementById("time");
    const numberInput = document.getElementById("number-input");
    const numberElement = document.getElementById("number");
    const addButton = document.getElementById("add");
    const subtractButton = document.getElementById("subtract");

    // 顯示現在時間
    function updateTime() {
      const now = new Date();
      timeElement.textContent = now.toLocaleString();
    }

    // 設定初始數字
    let number = 0;

    // 更新數字
    function updateNumber() {
      numberElement.textContent = number;

      // 建立 SSE 事件
      const event = new EventSource("/api/sse");

      // 監聽 SSE 事件
      event.addEventListener("message", (e) => {
        const data = JSON.parse(e.data);
        number = data.number;
        updateNumber();
      });
    }

    // 加一
    addButton.addEventListener("click", () => {
      number++;
      updateNumber();

      // 上傳伺服器
      fetch("/api/update-number", {
        method: "POST",
        body: JSON.stringify({ number }),
      });
    });

    // 減一
    subtractButton.addEventListener("click", () => {
      number--;
      updateNumber();

      // 上傳伺服器
      fetch("/api/update-number", {
        method: "POST",
        body: JSON.stringify({ number }),
      });
    });

    // 使用者輸入數字
    numberInput.addEventListener("input", () => {
      const inputNumber = parseInt(numberInput.value);
      if (isNaN(inputNumber)) {
        return;
      }

      number = inputNumber;
      updateNumber();

      // 上傳伺服器
      fetch("/api/update-number", {
        method: "POST",
        body: JSON.stringify({ number }),
      });
    });

    // 初始化
    updateTime();
    updateNumber();

    // 每秒更新時間
    setInterval(updateTime, 1000);
  </script>
</body>
</html>
